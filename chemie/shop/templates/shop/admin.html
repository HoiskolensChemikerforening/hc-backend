{% extends "chemie/base.html" %}
{% load staticfiles %}
{% load thumbnail %}

<head>
  <meta charset="UTF-8">
  <title>Chemshop admin</title>
</head>


{% block content %}
<div class="nav-wrapper" style="line-height: 56px; padding-bottom: 10px;">
  <a href="{% url "shop:index" %}" class="breadcrumb">Shop</a>
  <a class="breadcrumb">Admin</a>
</div>
<div style="display:flex;justify-content: space-between;">
  <span><a class="waves-effect waves-light btn" href="{% url "shop:add-item" %}">Legg til vare</a></span>
  <span><a class="waves-effect waves-light btn" href="{% url "shop:add-category" %}">Legg til kategori</a></span>
  <span><a class="waves-effect waves-light btn" href="{% url "shop:refill" %}">Fyll p√• konto</a></span>
</div>
<!-- See JS footer-script for element creating -->
<div id="admin-list-parent" style="margin-top: 1rem; margin-left: -0.1rem">
</div>


{% endblock content %}
{% block footer_script %}
<script type="text/javascript">
  const monthNames = ['Desember', 'November', 'Oktober', 'September', 'August', 'Juli', 'Juni', 'Mai', 'April', 'Mars', 'Februar', 'Januar']
  // transfers the list to backwards this month first following previous month
  var monthNumber = new Date().getMonth();
  for (i = 0; i < (11 - monthNumber); i++) {
    let firthElement = monthNames.shift()
    monthNames.push(firthElement)
  }

  // preprocess string to create list of item names
  var items = "{{items}}"
  items = items.replace(/&#39;/g, '');
  items = items.replace('[', '');
  items = items.replace(']', '');
  var itemList = items.split(',');
  for (var i = 0; i < itemList.length; i++) {
    var itemName = itemList[i]
    if (itemName[0] == ' ') {
      itemName = itemName.replace(' ', '')
    }
    itemList[i] = itemName
  }

  // create a empty list of dictionaries for each month
  var adminList = []
  for (var i = 0; i < 12; i++) {
    var itemDict = {}
    for (var j = 0; j < itemList.length; j++) {
      itemList[itemList[j]] = 0
    }
    adminList.push(itemDict)
  }

  var orderItems = "{{order_items}}"
  orderItems = orderItems.replace(/&#39;/g, '');
  orderItems = orderItems.replace('[', '');
  orderItems = orderItems.replace(']', '');
  orderItems = orderItems.replace(/{/g, '');
  var orderItemList = orderItems.split('},');
  for (i = 0; i < 12; i++) {
    var monthOrder = orderItemList[i]
    var monthOrderItems = monthOrder.split(',')
    for (var j = 0; j < monthOrderItems.length; j++) {
      if (monthOrderItems[j].trim() === "") {
        continue;
      }
      else {
        debugger;
        var orderNameQuantity = monthOrderItems[j].split(':');
        var quantity = parseInt(orderNameQuantity[1].replace(' ', ''));
        var itemName = orderNameQuantity[0].replace(' ', '');
        adminList[i][itemName] = quantity;
      }
    }
  }

  var adminDiv = document.getElementById("admin-list-parent");
  for (i = 0; i < 12; i++) {
    var monthTitle = document.createElement("h4")
    monthTitle.innerHTML = monthNames[i]
    adminDiv.appendChild(monthTitle)
    var monthDiv = document.createElement("div");
    monthDiv.setAttribute("style", "display: flex; flex-wrap:wrap; margin-top:2rem")
    for (j = 0; j < itemList.length; j++) {
      var itemDiv = document.createElement("div");
      itemDiv.setAttribute("style", "padding:0.4rem; height:4rem;border-style:solid")
      var itemDivChild1 = document.createElement("div")
      itemDivChild1.setAttribute("style", "height:1.5rem; min-width:4rem; text-align:left")
      itemDivChild1.innerHTML = itemList[j]
      var itemDivChild2 = document.createElement("div")
      itemDivChild2.innerHTML = adminList[i][itemList[j]]
      itemDivChild2.setAttribute("style", "height:1.5rem; text-align:left; min-width:4rem")
      itemDiv.appendChild(itemDivChild1)
      itemDiv.appendChild(itemDivChild2)
      monthDiv.appendChild(itemDiv);
    }
    adminDiv.appendChild(monthDiv)
  }


</script>
{% endblock footer_script %}