{% extends "chemie/base.html" %}
{% load thumbnail %}

<head>
  <meta charset="UTF-8">
  <title>Chemshop</title>
</head>

{% block nav_header %}
Chemshop
{% endblock nav_header %}

{% block content %}
<script>
  // The dictionary is the equivalent shopping cart 
  var item_dict = {}
</script>
{% for item in items %}
<div class="row">
  <div class="col s12 m4 l3">
    <div class="card sticky-action small">
      <div class="card-image waves-effect waves-block waves-light">
        {% thumbnail item.image "630x400" as pic %}
        <img class="activator" src="{{ pic.url }}">
        {% endthumbnail %}
      </div>
      <div class="card-content">
        <span class="card-title activator grey-text text-darken-4">{{ item.name }}<i
            class="material-icons right">more_vert</i></span>
      </div>
      <div class="card-reveal">
        <span class="card-title grey-text text-darken-4">{{ item.name }}<i class="material-icons right">close</i></span>
        <p>{{ item.description|default_if_none:"Ingen beskrivelse tilgjengelig" }}</p>
      </div>
      <div class="card-action"> {{ item.price }} kr
        <span class="right">
          <div id="input_div">
            <input type="text" size="1" value="0" id="item_{{item.name}}">

            <script type="text/javascript">
              item_dict["{{item.name}}"] = 0 // appends item to dictionary 
              
              //user presses the + button
              function plus(item_name){
                  item_dict[item_name]++
                  document.getElementById('item_'+ item_name).value = item_dict[item_name];
              }

              // user presses the - button
              function minus(item_name){
                item_dict[item_name]--
                document.getElementById('item_'+ item_name).value = item_dict[item_name];
              }  
            </script>
            <input type="button" value="-" id="moins" onclick="minus('{{item.name}}')">
            <input type="button" value="+" id="plus" onclick="plus('{{item.name}}')">
        </div>
        </span>
      </div>
    </div>
  </div>
</div>
{% endfor %}

{% if cart.cart %}
<div class="fixed-action-btn" style="bottom: 3.05rem; left: 1.7rem;">
  <a class="btn-floating btn-large">
    <i class="large material-icons yellow darken-2">shopping_cart</i>
  </a>
</div>
<div>
  The cart contains:
  {% for item_names, item_details in cart.cart.items %}
  <div>
    Item: {{ item_names }},
    Quantity: {{item_details.quantity}},
    Price: {{item_details.price}}
  </div>
  {% endfor %}
  Total: {{ cart.get_total_price }}
</div>
<form method="POST"> {% csrf_token %}
  <button class="waves-effect waves-light btn" type="submit" name="checkout" value="checkout">Kj√∏p varer</button>
</form>
{% endif %}

{% if perms.shop.add_item %}
<div class="fixed-action-btn" style="bottom: 45px; right: 24px;">
  <a class="btn-floating btn-large">
    <i class="large material-icons">edit</i>
  </a>
  <ul>
    <li>
      <a class="btn-floating blue" href="{% url "shop:add-item" %}"><i class="material-icons">add</i></a>
      <a class="btn-floating mobile-fab-tip">Opprett vare</a>
    </li>
    {% if perms.shop.add_category %}
    <li>
      <a class="btn-floating blue" href="{% url "shop:add-category" %}"><i class="material-icons">add</i></a>
      <a class="btn-floating mobile-fab-tip">Opprett kategori</a>
    </li>
    {% endif %}
    {% if perms.customprofile.can_refill_balance %}
    <li>
      <a class="btn-floating blue" href="{% url "shop:refill" %}"><i class="material-icons">add</i></a>
      <a class="btn-floating mobile-fab-tip">Fyll konto</a>
    </li>
    {% endif %}
  </ul>
</div>
{% endif %}
{% endblock content %}

{% block footer_script %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    var elems = document.querySelectorAll('.pushpin');
    var instances = M.Pushpin.init(elems, { "top": 60 });
  });
</script>
{% endblock footer_script %}