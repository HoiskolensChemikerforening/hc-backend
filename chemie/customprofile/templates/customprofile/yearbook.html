<!-- Klassekatalog side -->

{% extends "chemie/base.html" %}
{% load thumbnail %}
{% load staticfiles %}

{% block nav_header %}
  Klassekatalog
{% endblock nav_header %}

{% block nav_sub_header %}
  Oversikt
{% endblock nav_sub_header %}

{% block extra_css %}
  <link href='{% static "css/detailview.css" %}' type="text/css" rel="stylesheet" media="screen,projection"/>
  <style>
    @media (max-width: 1000px) {
      .scroll-on-phone {
        display: flex;
        flex-wrap: nowrap;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        gap: 10px;
        padding: 8px 0;
      }
      .scroll-on-phone .col {
      margin-left: 10px !important;
      padding-left: 0 !important;
    }
      .scroll-on-phone .col:not(:first-child) {
        margin-left: 10px;
      }
    }
  </style>
{% endblock %}

{% block extra_js %}
  <script src='{% static "js/hammer.min.js" %}' defer></script>
{% endblock %}


{% block content %}
  {% if perms.customprofile %}
    <div class="fixed-action-btn" style="bottom: 45px; right: 24px;">
      <a class="btn-floating btn-large">
        <i class="large material-icons">menu</i>
      </a>
      <ul>
        <li>
          <a class="btn-floating blue" href='{% url "profile:memberships" %}'><i
              class="material-icons">edit</i></a>
          <a class="btn-floating mobile-fab-tip">Se medlemsoversikt</a>
        </li>
      </ul>
    </div>
  {% endif %}


<div class="column">
  <div class="col s6 m6 l7 s12">
    <nav>
      <div class="nav-wrapper">
        <form method='post' class="newPost">{% csrf_token %}
          <div class="input-field">
            <input id="{{ search_form.search_field.id_for_label }}"
                    type="search" required name="{{ search_form.search_field.html_name }}"
                    value="{{ search_form.search_field.value|default:'' }}" style="background-color: #6288A5;">
            <label for="{{ search_form.search_field.id_for_label }}" class="label-icon">
              <i class="material-icons" style="line-height: 42px;">search</i></label>
          </div>
        </form>
      </div>
    </nav>
  </div>
  <br>
  <!-- Dropdown filters -->
  <div class="row scroll-on-phone">
    <div class="col s4 m4 l4 s6" style="display: flex;flex-direction: row;margin-right: 0">
      <div style="margin-right: 10px">
        <a class='dropdown-trigger btn-large' href='#' data-target='dropdown1'
          >Klassetrinn</a>
      <ul id='dropdown1' class='dropdown-content select-dropdown multiple-select-dropdown'>
        {% for year_number, year_text in grades %}
          <li><a href='{% url "profile:yearbook-forsok1810" klassetrinn=year_number sivilstatus=sivilstatus digimedaljer=digimedaljer spesialisering=spesialisering %}'>{{ year_text }}</a></li>
        {% endfor %}
      </ul>
      </div>
      <div style="margin-right: 10px">
        <a class='dropdown-trigger btn-large' href='#' data-target='dropdown4'
          >Digidaljer</a>
        <ul id='dropdown4' class='dropdown-content select-dropdown multiple-select-dropdown'>
          <li><a href='{% url "profile:yearbook-forsok1810" sivilstatus=sivilstatus klassetrinn=klassetrinn digimedaljer=None spesialisering=spesialisering %}'>Alle</a></li>
          {% for medal_title in medals %}
            <li><a href='{% url "profile:yearbook-forsok1810" digimedaljer=medal_title klassetrinn=klassetrinn sivilstatus=sivilstatus spesialisering=spesialisering %}'>{{ medal_title }}</a></li>
          {% endfor %}
        </ul>
      </div>
      <div style="margin-right: 10px">
        <a class='dropdown-trigger btn-large' href='#' data-target='dropdown5'
          >Sivilstatus</a>
        <ul id='dropdown5' class='dropdown-content select-dropdown multiple-select-dropdown'>
          <li><a href='{% url "profile:yearbook-forsok1810" sivilstatus=None klassetrinn=klassetrinn digimedaljer=digimedaljer spesialisering=spesialisering %}'>Ingen filter</a></li>
          {% for rel_number, rel_text in relstat %}
            <li><a href='{% url "profile:yearbook-forsok1810" sivilstatus=rel_number klassetrinn=klassetrinn digimedaljer=digimedaljer spesialisering=spesialisering %}'>{{ rel_text }}</a></li>
          {% endfor %}
        </ul>
      </div>
      <div>
      <a class='dropdown-trigger btn-large' href='#' data-target='dropdown3'
          >Spesialisering</a>
      <ul id = 'dropdown3' class='dropdown-content'>
        <li><a href='{% url "profile:yearbook-forsok1810" spesialisering=None klassetrinn=klassetrinn sivilstatus=sivilstatus digimedaljer=digimedaljer %}'>Alle </a></li>
        {% for spec_value, spec_text in spec %}
            {% if spec_value == 1 %}
              <li><a href='{% url "profile:yearbook-forsok1810" spesialisering=spec_value klassetrinn=klassetrinn sivilstatus=sivilstatus digimedaljer=digimedaljer %}'>Ikke valgt </a></li>
            {% else %}
              <li><a href='{% url "profile:yearbook-forsok1810" spesialisering=spec_value klassetrinn=klassetrinn sivilstatus=sivilstatus digimedaljer=digimedaljer %}'>{{ spec_text }}</a></li>
            {% endif %}
        {% endfor %}
      </div>
      {% if grade == grades.DONE %}
        <div style="margin-left:20px ">
          <form method='post' class="newPost">{% csrf_token %}
            <a class='dropdown-trigger btn-large' href='#' data-target='dropdown7'
          >Slutt√•r</a>
            <ul class="dropdown-content" id="dropdown7" style="max-height: 250px">
              {% for end_year in end_years %}
                <li>
                  <button 
                    class="newbtn" id="year-{{end_year}}" type="submit" 
                    name="{{ endYearForm.integer_field.html_name }}" value="{{ end_year}}"
                    >
                    {{end_year}}
                  </button>
                </li>
              {% endfor %}
            </ul>
          </form>
        </div>
      {% endif %}
      <div style="margin-left: 10px"> <!-- Remove filter button -->
        <a class='btn-large' href='{% url "profile:yearbook-index" %}'
          >Nullstill!</a>
      </div>
    </div>
  </div>
</div>

<!-- Shows all the students which are seemingly put into three columns, but is really one long row -->
<div class="row">
  {% for profile in profiles %}
    <div class="col s12 m4">
      <!-- When card is pressed, a detail view pops up. -->
      <div class="card">
        <!-- Showing the pictures. -->
        <div class="card-image">
          {% thumbnail profile.image_primary "412x551" crop="center" as primary %}
            <img src="{{ primary.url }}" data-field-id="#modal-{{ profile.pk }}"
                {% thumbnail profile.image_secondary "412x551" crop="center" as secondary %}
                  data-alt-src="{{ secondary.url }}"
                {% endthumbnail %}>
          {% empty %}
            <img src="{% static 'images/blank_avatar.png' %}" data-field-id="#modal-{{ profile.pk }}" >
          {% endthumbnail %}
        </div>

        <!-- The box under each picture -->
        <div class="card-content">
          <a class="card-title">{{ profile }}</a>
          {% if profile.relationship_status == 1 %}
            <i class="material-icons icon-green">favorite</i>
          {% elif profile.relationship_status == 2 %}
            <i class="material-icons icon-red">favorite</i>
          {% elif profile.relationship_status == 4 %}
            <i class="material-icons" style="color: #f9cf00;">favorite</i>
          {% else %}
            <i class="material-icons icon-gray">favorite</i>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Detail view in yearbook -->
    <div id="modal-{{ profile.pk }}" class="modal">

      <!-- All content in popup goes here -->
      <div class="modal-content">

        <div class="row">
          <!-- Picture in detail view -->
          <div class="center-align">
            <div class="col s12 m4 l4">
                {% thumbnail profile.image_primary "400x680" crop="center" as primary %}
                    <img src="{{ primary.url }}" alt="" class="rcorners6 responsive-img z-depth-1"
                          href="#modal-{{ profile.pk }}" style="margin-top: 10px;">
                {% empty %}
                    <img src="{% static 'images/blank_avatar.png' %}" alt="" class="rcorners6 responsive-img z-depth-1" style="margin-top: 10px;">
                {% endthumbnail %}
            </div>
          </div>

          <!-- All text in view-->
          <div class="col s12 m8 l8">
            <div class="center-align">
              <h4 class="grey-text darken-4" style="margin-top: 70px;">{{ profile }}</h4>
              <p>Klassetrinn: {{ profile.get_nice_grade }}</p>
              <p>E-post: <a href="mailto:{{ profile.user.email }}">{{ profile.user.email }}</a></p>
              <p>Mobilnummer: {{ profile.phone_number }}</p>
              <p>Samlivsstatus: {{ profile.get_nice_relationship_status }}</p>
              {% if profile.specialization != 1 %} <!--Check if person has a specialization-->
                <p> Spesialisering: {{profile.get_nice_specialization }}</p>
              {% endif %}
              <div class="row">
                {% for medal in profile.medals.all %}
                  <img src="{{ medal.image.url }}" alt="{{ medal.title }}"
                        title="{{ medal.title }}" style="height:50px;width:auto;">
                {% endfor %}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer on popup. Contains closing button. -->
      <div class="modal-footer">
        <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat">Lukk</a>
        <a href="mailto:{{ profile.user.email }}"
            class="modal-action modal-close waves-effect waves-green btn-flat">Send e-post</a>
      </div>
    </div>

  {% endfor %}
</div>
                  
<!-- Pagination (shows when `profiles` is a Page with multiple pages) -->
{% if profiles and profiles.has_other_pages %}
<ul class="pagination nav navbar-nav" >
  {% if profiles.has_previous %}
    <li><a href="?page={{ profiles.previous_page_number }}">Forrige</a></li>
  {% endif %}
  {% for page in profiles.paginator.page_range %}
    <li class="{% if profiles.number == page %}active{% endif %}"><a href="?page={{ page }}">{{ page }}</a></li>
  {% endfor %}

  {% if profiles.has_next %}
    <li><a href="?page={{ profiles.next_page_number }}">Neste</a></li>
  {% endif %}
</ul>
{% endif %}

<!--Copilot backup

{% if profiles and profiles.has_other_pages %}
<nav aria-label="Sider" style="margin: 1rem 0; text-align:center;">
  <ul class="pagination" style="display:inline-flex; gap:0.5rem; list-style:none; padding:0;">
    {% if profiles.has_previous %}
      <li class="page-item"><a class="page-link btn" href="{{ url }}?page={{ profiles.previous_page_number }}">Forrige</a></li>
    {% else %}
      <li class="page-item disabled"><span class="page-link btn disabled">Forrige</span></li>
    {% endif %}

    <li class="page-item active"><span class="page-link btn">{{ profiles.number }} / {{ profiles.paginator.num_pages }}</span></li>

    {% if profiles.has_next %}
      <li class="page-item"><a class="page-link btn" href="{{ url }}?page={{ profiles.next_page_number }}">Neste</a></li>
    {% else %}
      <li class="page-item disabled"><span class="page-link btn disabled">Neste</span></li>
    {% endif %}
  </ul>
</nav>
{% endif %}
-->
{% endblock content %}

{% block footer_script %}
  <script>
      var sourceSwap = function () {
          var $this = $(this);
          var newSource = $this.data('alt-src');
          $this.data('alt-src', $this.attr('src'));
          $this.attr('src', newSource);
      };

      $(function () {
          $('img[data-alt-src]').each(function () {
              new Image().src = $(this).data('alt-src');
          }).hover(sourceSwap, sourceSwap);
      });

      // Functions for double tap (swap image) and tap/click (show modal)
      // https://codepen.io/jtangelder/pen/pBuIw
      $(document).ready(function () {
          $('.card-image').each(function () {
              var $this = $(this);
              var mc = new Hammer.Manager(this);

              // Tap recognizer with minimal 2 taps
              mc.add(new Hammer.Tap({event: 'double_tap', taps: 2}));

              // Single tap recognizer
              mc.add(new Hammer.Tap({event: 'single_tap'}));

              // we want to recognize this simulatenous, so a quadrupletap will be detected even while a tap has been recognized.
              mc.get('double_tap').recognizeWith('single_tap');
              // we only want to trigger a tap, when we don't have detected a doubletap
              mc.get('single_tap').requireFailure('double_tap');

              // Double tap swaps the images
              mc.on("double_tap", function (e) {
                  sourceSwap.call(e.srcEvent.target);
                  return false;
              });

              // Single tap calls the modal trigger
              mc.on("single_tap", function (e) {
                  id = e.srcEvent.target.getAttribute('data-field-id');
                  $(id).modal('open');
                  return false;
              });
          });
          $('.dropdown-trigger').dropdown();
          $('.modal').modal();
      });




  </script>


{% endblock %}
