{% extends "chemie/base.html" %}
{% load staticfiles %}


{% block header %}
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.26.6/js/jquery.tablesorter.min.js"></script>
    <script>
        $(function () {
            $('table').tablesorter();
        });
    </script>
{% endblock header %}

{% block nav_header %}
    Arrangementer
{% endblock nav_header %}

{% block nav_sub_header %}
    Påmeldte
{% endblock nav_sub_header %}

{% block content %}
    <div class="row">
        <div class="col s12 m12 l12"><h3 class="heading">{{ event.title }}</h3></div>
    </div>
    <div class="row">
        <table id="myTable" class="tablesorter">
            <thead>
            <tr>
                <th>Navn</th>
                <th>Klassetrinn</th>
                <th>Allergier</th>
                {% if event.night_snack %}
                    <th>Nattmat</th>
                {% endif %}
                {% if event.companion %}
                    <th>Følge</th>
                {% endif %}
                {% if event.sleepover %}
                    <th>Overnatting</th>
                {% endif %}
                <th>HC-medlemsskap</th>
                <th>Betalt</th>
            </tr>
            </thead>

            <tbody>
            {% for attendee in attendees %}
                <tr>
                    <td>{{ attendee.user.profile }} </td>
                    <td>{{ attendee.user.profile.grade }}</td>
                    <td>{{ attendee.user.profile.allergies }}</td>
                    {% if event.night_snack %}
                        <td>
                            <i class="material-icons">done</i>
                    {% endif %}
                    {% if attendee.companion %}
                        <td>
                            {{ attendee.companion }}
                        </td>
                    {% endif %}
                    {% if event.sleepover %}
                        <td>
                            {% if attendee.sleepover %}
                                <i class="material-icons">done</i>
                            {% endif %}
                        </td>
                    {% endif %}

                    <td>{{ attendee.user.profile.membership.is_active }}</td>
                    <td>
                        {% if attendee.payment_status %}
                            <a class="payment btn-floating btn-tiny waves-effect waves-light green"
                               id="payment-{{ attendee.id }}"><i class="material-icons">done</i></a>
                        {% else %}
                            <a class="payment btn-floating btn-tiny waves-effect waves-light red"
                            id="payment-{{ attendee.id }}"><i class="material-icons">error</i></a>
                        {% endif %}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    <script>
    $( document ).ready(function() {
        $('.payment').on('click', function(event){
            event.preventDefault();
            var myID = $(this).attr("id");
            // using jQuery
            function getCookie(name) {
                var cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    var cookies = document.cookie.split(';');
                    for (var i = 0; i < cookies.length; i++) {
                        var cookie = jQuery.trim(cookies[i]);
                        // Does this cookie string begin with the name we want?
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
            var csrftoken = getCookie('csrftoken');
            console.log(myID);
            $.ajax({
                type: "POST",
                url: "/events/adminlist/paymentstatus/"+myID.split('-')[1],
                data: {
                    myID: myID,
                    csrfmiddlewaretoken: csrftoken,
                },

                success: function(data){
                    console.log($(this));

                },
                error: function(data){
                    console.log($(this));
                    $(this).html('hei');
                },
            });
        })
    });
    </script>

{% endblock content %}