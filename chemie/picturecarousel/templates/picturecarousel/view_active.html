{% extends 'chemie/base.html' %}
{% load thumbnail %}
{% load material_form %}
{% load staticfiles %}
{% load static %}
{% block nav_header %}
  Bilder
{% endblock nav_header %}

{% block nav_sub_header %}
  Aktive bilder
{% endblock nav_sub_header %}

{% block content %}
  <style xmlns:carousel="http://www.w3.org/1999/xhtml">
    img.responsive-img {
      height: auto;
      width: auto;
      max-width: 300px;
    }
  </style>
  {% if perms.picturecarousel %}
    <div class="fixed-action-btn" style="bottom: 45px; right: 24px;">
      <a class="btn-floating btn-large">
        <i class="large material-icons">edit</i>
      </a>
      <ul>
        {% if perms.picturecarousel %}
          <li>
            <a class="btn-floating blue" href="{% url "carousel:active" %}">
              <i class="material-icons">edit</i>
            </a>
            <a class="btn-floating mobile-fab-tip">Tagg bilder</a>
          </li>
          <li>
            <a class="btn-floating blue" href="{% url "carousel:overview" %}">
              <i class="material-icons">list</i>
            </a>
            <a class="btn-floating mobile-fab-tip">Godkjenn bilder</a>
          </li>
        {% endif %}
      </ul>
    </div>
  {% endif %}

  <ul class="pagination nav navbar-nav">
    {% if pictures.has_previous %}
      <li><a href="{{ pictures.previous_page_number }}">Forrige</a></li>
    {% endif %}
    {% for page in pictures.paginator.page_range %}
      <li class="{% if pictures.number == page %}active{% endif %}"><a href="{{ page }}">{{ page }}</a></li>
    {% endfor %}

    {% if pictures.has_next %}
      <li><a href="{{ pictures.next_page_number }}">Neste</a></li>
    {% endif %}
  </ul>

  <div id="filterDiv">
    {{ filter_form }}
  </div>
  <button class="btn btn-default" style="margin-top:5px;"
          onclick="filterPictures()">Filtrer!
  </button>


  <div class="row">
    <h3>Aktive bilder</h3>
    <div class="card">
      <div class="card-content">
        <table class="responsive-table bordered">
          <thead>
          <tr>
            <th data-field="image">Bilde</th>
            <th data-field="image">Tags</th>
            <th data-field="who">Innsender</th>
            <th data-field="date">Dato</th>
          </tr>
          </thead>
          <tbody>
          {% for pic in pictures %}
            <tr class="pictureTr {{ pic.tags.all }}">
              <td>
                <img class="responsive-img materialboxed" src="{{ pic.image.url }}" alt="">
              </td>
              <td>
                {% for tag in pic.tags.all %}
                  <p>
                  <div class="chip">{{ tag }}</div>
                  </p>
                {% endfor %}
              </td>
              <td><p>{{ pic.author }}</p></td>
              <td><p>{{ pic.date|date:"j. F" }}</p></td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
{% endblock content %}

{% block footer_script %}
  {{ filter_form.media }}

  <script>
      let filterPictures = function () {
          let filterDiv = document.getElementById("filterDiv");
          let tagDivs = filterDiv.childNodes[2].childNodes[0].childNodes[0].childNodes[0].childNodes;
          let tags = [];

          for (let i = 1; i < tagDivs.length - 1; i++) {
              tags.push(tagDivs[i].innerText.slice(1));
          }

          let pictures = document.getElementsByClassName("pictureTr");

          for (let i = 0; i < pictures.length; i++) {
              console.log(pictures[i].className);
              let isShown = true;
              for (let j = 0; j < tags.length; j++) {
                  if (!pictures[i].className.includes(tags[j])) {
                      isShown = false;
                  }
              }

              if (isShown) {
                  pictures[i].style.removeProperty("display");
              } else {
                  pictures[i].style.display = "none";
              }
          }
      };

      $(document).ready(function () {
          $('.materialboxed').materialbox();
      });

  </script>

{% endblock footer_script %}
