{% extends 'chemie/base_election.html'%}


<!--
context = {
    'candidates': position.candidates.all(),
    'number_of_voters': number_of_voters,
    'blank_votes': blank_votes
}
-->
{% block content%}

<div style="margin:1rem">
  {% if messages %}
  <ul class="messages">
    {% for message in messages %}
    <li {% if message.tags %} class="{{ message.tags }}" {% endif %}>{{ message }}</li>
    <li> {{ message.extra_tags }}</li>
    {% endfor %}
  </ul>
  {% endif %}


  <script type="text/javascript">
    const total_votes = parseInt("{{total_votes}}")
    const blank_votes = parseInt("{{blank_votes}}")
  </script>
  <div class="box">
    <h4 class="title is-6">Totalt antall stemmer: {{ total_votes }}</h4>
    <h4 class="title is-6">Blanke stemmer: {{ blank_votes }}</h4>
    <table class="table">
      <tr>
        <th>Kandidater</th>
        <th>Forh√•ndstemmer</th>
        <th>Avgitte stemmer</th>
        <th>Antall stemmer</th>
        <th>Prosent med blanke stemmer</th>
        <th>Prosent uten blanke stemmer</th>
      </tr>
      {% for candidate in candidates %}
      <tr>
        <td> {{ candidate.user.get_full_name }} </td>
        <td> {{ candidate.pre_votes }} </td>
        <td> {{ candidate.votes }} </td>
        <td>
          <p id="total_votes-{{candidate.id}}">2</p>
          <script type="text/javascript">
            var votes = parseInt("{{ candidate.votes }}");
            var preVotes = parseInt("{{ candidate.pre_votes }}");
            var candTotalVotes = votes + preVotes
            document.getElementById("total_votes-{{candidate.id}}").innerHTML = candTotalVotes;
          </script>
        </td>
        <td>
          <p id="voting_percentage-{{candidate.id}}"></p>
          <script type="text/javascript">
            var votes = parseInt("{{ candidate.votes }}");
            var preVotes = parseInt("{{ candidate.pre_votes }}");
            var percentage_with_blank = (100 * (votes + preVotes) / total_votes).toFixed(2);
            document.getElementById("voting_percentage-{{candidate.id}}").innerHTML = percentage_with_blank + " %";
          </script>
        </td>
        <td>
          <p id="voting_percentage-without-blank{{candidate.id}}"></p>
          <script type="text/javascript">
            var total_votes_without_blank = total_votes - blank_votes;
            var votes = parseInt("{{ candidate.votes }}");
            var preVotes = parseInt("{{ candidate.pre_votes }}");
            debugger;
            var percentage_without_blank = (100 * (votes + preVotes) / total_votes_without_blank).toFixed(2);
            document.getElementById("voting_percentage-without-blank{{candidate.id}}").innerHTML = percentage_without_blank + " %";
          </script>
        </td>
      </tr>
      {% endfor %}
    </table>
  </div>
  <br>
  <a class="btn btn-secondary" href="{% url "elections:admin_register_positions" %}">Tilbake</a>
</div>

{% endblock content %}