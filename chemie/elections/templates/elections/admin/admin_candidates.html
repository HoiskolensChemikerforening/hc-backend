{% extends 'chemie/base_election.html' %}
<!--context = {
            'candidates': candidates,
            'form': form,
            'position': position,
            'search_user': search_user
        }-->

{% load thumbnail %}
{% load static %}

{% block style %}
.candidate-container{
padding: 0.9rem;
margin-top: 0.3rem;
margin-bottom: 0.3rem;
}
.candidate-delete{
display: inline;
position: absolute;
right: 1rem;
}
.candidate-line{
display: inline;
}
.candidate-input{
display: inline;
width: 4rem;
}
.candidate-component{
margin-right: 0.2rem;
}
{% endblock style %}

{%block content%}
<div>
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb" style="background-color:#343a40;border-radius:0rem">
            <li class="breadcrumb-item "><a href="{%url "elections:admin_register_positions"%}"
                    style="color:#edcd2f">Admin</a></li>
            <li class="breadcrumb-item active" aria-current="page" style="color:#edcd2fb4">Register kandidater</li>
        </ol>
    </nav>
    <!--Tittel på possisjon-->
    <div class="d-flex">
        <div class="p-2" style="margin:2rem">
            <h3 class="title is-4"> Kandidater for {{ position.position_name }}</h3>
        </div>
        <div class="ml-auto p-2">
            <form method="post" href="#" onsubmit="return confirmValg(this,'Åpne valget for?')">{% csrf_token %}
                <button class="btn btn-success" type="submit" name="startVoting" value="{{position.id}}" }}>Start
                    valget</button>
            </form>
        </div>
    </div>





    <!--Søkefelt for brukere-->
    <div>
        <div style="margin:2rem">
            <form method="POST" action=""> {% csrf_token %}
                {{ add_candidate_form.user }}
                <input type="submit" class="btn btn-secondary" name="addCandidate" value="Legg til kandidat"
                    height="10px" />
            </form>
            {%if position.is_done%}
            <div class="div-container">
                <h2 class="title is-3"> Dette valget har alt blitt gjennomført*</h2>
                <p>*Hvis det skal gjøres gjenvalg på delte vinnerplasser, så lag en ny posisjon</p>
                <p>Eksempel: Festslave med 2 plasser hvor valget ga en vinner og to andreplasser.
                    Opprett et ny posisjon som heter Festslaver-gjennvalg med 1 plass og to kandidater
                </p>
            </div>
            {%endif%}
        </div>
    </div>

    <div class="d-flex flex-wrap">
        {%for candidate in candidates%}
        <div class="p-2"
            style="text-align:center; border-style: solid; border-radius: 1rem; margin:1rem; border-color:#343a40">
            <div class="p-2" style="height:100%">
                <div class="d-flex flex-column"></div>
                <div class="p-2" style="height:80%">
                    <img src="{{candidate.user.profile.image_primary.url}}" style="max-width:6rem">

                    <p class="p-2">
                        {{candidate}}
                        <br>
                        <b>{{candidate.votes}}</b> forhåndstemmer
                    </p>
                </div>

                <form class="mt-auto p-2" method="post" href="#" ; style="float:bottom;">{% csrf_token %}
                    <button class="btn btn-danger" type="submit" name="Delete"
                        value="{{candidate.user.username}}">Slett</button>
                </form>

            </div>


        </div>
        {%endfor%}
    </div>
    {% if candidates %}
    <div style="margin:2rem">
        <a href="{% url "elections:admin_register_prevotes" position.id %}" style="margin:1rem">
            <button class="btn btn-secondary">Legg inn forhåndsstemmer</button>
        </a>
    </div>

    {% endif %}


</div>
</div>
{% endblock content %}

{% block footer_script %}
{{ add_candidate_form.media }}
<script type="text/javascript">
    function confirmValg(form, message) {
        if (!form) {
            return false
        } else {
            var div = document.getElementsByClassName('candidate-container');
            var selectedCandidates = [];
            for (i = 0; i < div.length; i++) {
                let candidateName = div[i].children[0].innerHTML;
                let candidatePreVotes = div[i].children[1].children[4].children[0].innerHTML;
                let name = `\n ${candidateName} : ${candidatePreVotes} `;
                selectedCandidates.push(name);
            }
            console.log(typeof (selectedCandidates));
            var message = 'Starte valget med forhåndstemmer: ' + selectedCandidates;
            return confirm(message)
        }
    }
</script>

{% endblock footer_script %}