{% extends 'chemie/base_election.html' %}
<!--context = {
            'candidates': candidates,
            'form': form,
            'position': position,
            'search_user': search_user
        }-->

{% load thumbnail %}

{% load staticfiles %}
{% load static %}

{%block content%}
<style>
    .candidate-container{
        padding: 0.9rem;
        margin-top: 0.3rem;
        margin-bottom: 0.3rem;
    }
    .candidate-delete{
        display: inline;
        position: absolute;
        right: 1rem;
    }
    .candidate-line{
        display: inline;
    }
    .candidate-input{
        display: inline;
        width: 4rem;
    }
    .candidate-component{
        margin-right: 0.2rem;
    }
</style>
<div>
  <nav class="breadcrumb" aria-label="breadcrumbs">
    <ul>
      <li><a href="{% url "elections:admin_register_positions" %}">Admin</a></li>
      <li class="is-active"><a href="#" aria-current="page">Posisjon</a></li>
    </ul>
  </nav>
  <!--Tittel på possisjon-->
  <div class="">
      <h3 class="title is-4"> Kandidater for {{ position.position_name }}</h3>
  </div>


  <!--Søkefelt for brukere-->
  <div>
      <div>
          <form method="POST" action="" > {% csrf_token %}
              {{ add_candidate_form.user }}
              <input type="submit" class="button" name="addCandidate" value="Legg til kandidat" height="10px"/>
          </form>
          {%if position.voting_done%}
          <div class="div-container">
              <h2 class="title is-3"> Dette valget har alt blitt gjennomført*</h2>
              <p>*Hvis det skal gjøres gjenvalg på delte vinnerplasser, så lag en ny posisjon</p>
              <p>Eksempel: Festslave med 2 plasser hvor valget ga en vinner og to andreplasser.
                  Opprett et ny posisjon som heter Festslaver-gjennvalg med 1 plass og to kandidater
              </p>
          </div>
          {%endif%}
      </div>
  </div>

  <!--Alle Kandidater-->
  {%for candidate in candidates%}
  <div class="card border-secondary mb-3">
      <div class="card-body candidate-container" >
          <h5 class="title is-5"> {{candidate}}</h5>
          <form method="post" href="#"; style="display: inline" >{% csrf_token %}
          <button class="button candidate-delete" type="submit" name="Delete" value="{{candidate.user.username}}" >&#10060</button>
              <p> <b>{{candidate.votes}}</b> forhåndsstemmer</p>
          </form>
      </div>
  </div>
  {%endfor%}


  </div>
  <div>
      {% if candidates %}
      {% if not position.voting_done %}
      <form method="post" href="#" onsubmit="return confirmValg(this,'Åpne valget for?')">{% csrf_token %}
          <button class="button is-success is-pulled-left" type="submit" name="startVoting" value="{{position.id}}"}}>Start</button>
      </form>
      <a href="{% url "elections:admin_register_prevotes" position.id %}">
        <button class="button is-warning is-pulled-right" >Legg inn forhåndsstemmer</button>
      </a>
      {% endif %}
      {% endif %}
  </div>
</div>
{% endblock content %}

{% block footer_script %}
    {{ add_candidate_form.media }}
<script type="text/javascript">
function confirmValg(form, message) {
       if (!form){
           return false
       } else {
           var div = document.getElementsByClassName('candidate-container');
           var selectedCandidates = [];
           for (i=0; i<div.length; i++){
               let candidateName = div[i].children[0].innerHTML;
               let candidatePreVotes = div[i].children[1].children[4].children[0].innerHTML;
               let name = `\n ${candidateName} : ${candidatePreVotes} `;
               selectedCandidates.push(name);
           }
           console.log(typeof(selectedCandidates));
           var message = 'Starte valget med forhåndstemmer: ' + selectedCandidates;
           return confirm(message)
       }
    }
</script>

{% endblock footer_script %}
